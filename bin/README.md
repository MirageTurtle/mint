# Token-based Auth Demo

## Prerequisites

To use token-based authentication, you need to generate a private key and a corresponding self-signed certificate for the client.

This is different from real-world usage — see the [Notes](#notes) section for details.

Here's an example to generate an RSA key and self-signed certificate:
```bash
openssl req -newkey rsa:2048 -nodes -keyout /path/to/client.key -x509 -days 365 -out /path/to/client.crt
```

## Server

You can enable `clientauth` to require client authentication.
+ For standard TLS, it requires a client certificate.
+ For token-based auth, a valid client token also works.

Provide valid tokens with the validtokens flag (comma-separated).
Due to [limitation](#notes), you must also provide the client’s self-signed certificate via the clientcert flag.

Here's an example using the certificate generated by [Prerequisites](#prerequisites):
```bash
go run bin/mint-server-https/main.go -gencert -host localhost -port 4430 \
  -clientauth -validtokens demo-token-123,demo-token-987 \
  -clientcert /path/to/client.crt
```

## Client


Start the client with `tokenauth`, providing the `token` and the private `key` generated in the [Prerequisites](#prerequisites):
```bash
go run bin/mint-client-https/main.go -dontvalidate -url https://localhost:4430 \
  -tokenauth -token demo-token-123 -key /path/to/client.key
```

Expected output:
```text
Welcome to the TLS 1.3 zone!
```

## Notes

+ Due to limitations in the original Mint implementation, we use self-signed certificates for this demo.
To avoid breaking the interaction between server and client, and to keep the certificate (normally generated by the server) and private key (belonging to the client) consistent, we generate both the private key and self-signed certificate manually, then distribute them to the correct party.
+ For demo purposes, the server uses a self-signed certificate generated at runtime (`-gencert`). Therefore, the client must use `-dontvalidate` to bypass the certificate validation phase of standard one-way TLS.
